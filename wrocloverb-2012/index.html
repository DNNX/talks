<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Decoupling Persistence (Like Thereâ€™s Some Tomorrow)</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  
    <link rel="stylesheet" href="file/wrocloverb-2012.css" type="text/css"/>
  

  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content center" ref="cover/cover/1">
<p><img src="./file/cover/url.png" alt="http://decoupling-wrocloverb-2012.heroku.com"/></p>

<h2>&#xA0;</h2>

<h2><span style="font-family: Ubuntu, sans-serif"><a href="http://decoupling-wrocloverb-2012.heroku.com">decoupling-wrocloverb-2012.heroku.com</a></span></h2></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="cover/cover/2">
<h1>Decoupling Persistence</h1>

<h2>(Like There&#x2019;s Some Tomorrow)</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="cover/cover/3">
<h1>&#x2190; models | persistence &#x2192;</h1></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets center incremental" ref="me-me-me/me-me-me/1">
<p><img src="./file/me-me-me/chastell.png" alt="chastell"/></p>

<h1>me, me, me.</h1>

<ul>
<li>(that&#x2019;s Piotr Szotkowski)</li>
<li>(or <a href="http://chastell.net">chastell</a>)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="me-me-me/me-me-me/2">
<p><img src="./file/me-me-me/mu.png" alt="MU"/>
&#xA0;</p>

<h2><a href="http://university.rubymendicant.com">Mendicant University</a></h2>

<h2>community member</h2></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="me-me-me/me-me-me/3">
<p><img src="./file/me-me-me/wut.png" alt="Warsaw University of Technology"/>
&#xA0;</p>

<h2>assistant professor</h2>

<h2>at <a href="http://eng.pw.edu.pl">Warsaw University of Technology</a></h2></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="me-me-me/me-me-me/4">
<p><img src="./file/me-me-me/rebased.png" alt="Rebased"/>
&#xA0;</p>

<h2>cheap science officer</h2>

<h2>at <a href="http://rebased.pl">Rebased</a></h2></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="me-me-me/me-me-me/5">
<p><img src="./file/me-me-me/netwtorek-sochack.png" alt="NetWtorek + SocHack"/>
&#xA0;</p>

<h2><a href="http://netwtorek.pl">NetWtorek</a> + <a href="http://sochack.pl">SocHack</a></h2>

<h2>co-organiser</h2></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets center incremental" ref="current-status/current-status/1">
<h1>current status</h1>

<ul>
<li>install Ruby</li>
<li>install Rails</li>
<li>install MySQL</li>
<li>install The Ruby Racer</li>
<li>(probably don&#x2019;t need to)<br/>install Vim</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollRight"><div class="content center incremental" ref="current-status/current-status/2">
<p><img src="./file/current-status/vimsanity-wolf.jpg" alt="Vimsanity Wolf"/>
<a href="http://www.quickmeme.com/meme/36hy2h/">Insanity Wolf [by sgharms]</a></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content commandline incremental" ref="current-status/current-status/3">
<h1>current status</h1>

<pre><code><code class="command">$ rails new the-truth</code>
<code class="command">$ cd the-truth</code>
<code class="command">$ vim config/database.yml</code>
<code class="command">$ vim Gemfile</code>
<code class="command">$ rails generate model journalist name</code>
<code class="command">$ rails generate model article title body:text journalist:references</code>
<code class="command">$ rake db:migrate</code>
<code class="command">$ vim test/unit/{journalist,article}_test.rb</code>
</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets" ref="current-status/current-status/4">
<ul>
<li><div class="quote">If the first thing you type, when writing a Ruby app,<br/>is: &#x2018;rails&#x2019;, you&#x2019;ve already lost the architecture game.<br/>&#x2014; Uncle Bob Martin</div></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollRight"><div class="content center" ref="current-status/current-status/5">
<p><img src="./file/current-status/farnsworth.jpg" alt="prof. Farnsworth"/>
<a href="http://imgur.com/NMuzY">Meme&#x2026; fusion!</a></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="databases/databases/1">
<h1>\o/ &#xA0; yay, databases! &#xA0; \o/</h1>

<ul>
<li>why?</li>
<li>what do we want?</li>
<li>TIME TRAVEL!</li>
<li>when do we want it?</li>
<li>THAT&#x2019;S IRRELEVANT!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="databases/databases/2">
<h1>\o/ &#xA0; yay, databases! &#xA0; \o/</h1>

<ul>
<li><div class="quote">A database is a black hole into which you put your data.<br/>If you&#x2019;re lucky, you&#x2019;ll get it back again.<br/>If you&#x2019;re very lucky, you&#x2019;ll get it back in a form you can use.<br/>&#x2014; Charlie Gibbs</div></li>
<li><div class="quote">&#x2018;It looks like you&#x2019;re creating a database. Most likely<br/>you&#x2019;d like it in Latin1 encoding with Swedish collation.&#x2019;<br/>No, MySQL, no, I wouldn&#x2019;t.<br/>&#x2014; James Higgs</div></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollRight"><div class="content center incremental" ref="databases/databases/3">
<p><img src="./file/databases/zebras.jpg" alt="zebras"/>
<a href="http://eddirt.frozenreality.co.uk/?id=550">Edible Dirt</a></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="databases/databases/4">
<h1>\o/ &#xA0; yay, databases! &#xA0; \o/</h1>

<ul>
<li>MySQL, PostgreSQL, SQLite | <a href="https://github.com/copiousfreetime/amalgalite">embedded</a>?</li>
<li>CouchDB, MongoDB | <a href="https://github.com/gdb/embedded-mongo">embedded</a>?</li>
<li>in memory: Redis | <a href="https://github.com/benlund/roc">ROC</a>!</li>
<li>graph databases? Neo4j!</li>
<li>directory services? LDAP!</li>
<li>how about <a href="https://github.com/Nico-Taing/yaml_record">YAML Record</a> or PStore?</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="databases/databases/5">
<h1>\o/ &#xA0; yay, databases! &#xA0; \o/</h1>

<ul>
<li>how about object databases?</li>
<li><a href="http://maglev.gemstone.com">MagLev</a> 1.0 released!</li>
<li><a href="http://madeleine.rubyforge.org">Madeleine</a></li>
<li><a href="https://github.com/adelcambre/cubbyhole">Cubbyhole</a></li>
<li><div class="quote">Now that people are considering NoSQL<br/>will more people consider no-database?<br/>&#x2014; Martin Fowler</div></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content center incremental" ref="databases/databases/6">
<h2>polyglot persistence</h2>

<p><img src="./file/databases/polyglot-persistence.png" alt="polyglot persistence"/>
<a href="http://architects.dzone.com/articles/polyglot-persistence-future">Martin Fowler: The Future is not just NoSQL, it&#x2019;s Polyglot Persistence</a></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="separation/separation/1">
<h1>&#x2190; models | persistence &#x2192;</h1>

<ul>
<li><div class="quote">When I open up a Rails project and the models dir is full of 100% ActiveRecord classes I shudder. Model &#x2260; Persistence.<br/>&#x2014; Ben Mabey</div></li>
<li><div class="quote">We need something better. Persistance and logic are two separate responsibilities that every Rails app combines.<br/>&#x2014; Steve Klabnik</div></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="separation/separation/2">
<h1>&#x2190; models ! persistence &#x2192;</h1>

<ul>
<li>backend independence!</li>
<li>no shortcuts! explicit shortcuts!</li>
<li>easier modelling!</li>
<li>future-proof(er) design!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="separation/separation/3">
<h1>&#x2190; models ! persistence &#x2192;</h1>

<ul>
<li>cleaner, simpler tests!</li>
<li><strong>faster</strong> tests!</li>
<li>separate persistence driver testing!</li>
<li>Rails is not your app &#x2013; don&#x2019;t unit-test it!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="separation/separation/4">
<h1>&#x2190; models ? persistence &#x2192;</h1>

<ul>
<li>performance?</li>
<li>(perceived?) compexity?</li>
<li>YAGNI?</li>
<li>Just Use <a href="https://github.com/nulldb/nulldb">NullDB</a>&#x2122;?</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="separation/separation/5">
<h1>it&#x2019;s object-oriented</h1>

<ul>
<li><div class="quote">The biggest reason&#x2014;scratch that, the <em>only</em> reason&#x2014;is to make our apps easier to change. The only constant in life is change, and that goes double for software projects. [&#x2026;] Rails is reaching a point at the time of writing where a lot of projects are starting to mature, and a lot of developers are realizing their projects aren&#x2019;t nearly as easy to modify as they used to be. &#xA0; &#x2014; Avdi Grimm, <em><a href="http://objectsonrails.com">Objects on Rails</a></em></div></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="separation/separation/6">
<h1>it&#x2019;s object-oriented</h1>

<ul>
<li><div class="quote">Attempts to predict <em>which</em> parts of a codebase will need to change, and to structure it accordingly, have ended badly more often than not. Part of the nature of change is that you often don&#x2019;t know beforehand <em>what</em> is going to need change. [&#x2026;] Much like premature optimization, premature change management usually misses the mark.<br/>&#x2014; Avdi Grimm, <em><a href="http://objectsonrails.com">Objects on Rails</a></em></div></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollRight"><div class="content center incremental" ref="separation/separation/7">
<p><img src="./file/separation/change.jpg" alt="change"/>
<a href="http://ncse.com/rncse/29/6/very-gradual-change-we-can-believe">(Very Gradual) Change We Can Believe In</a></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="separation/separation/8">
<h1>please mister how do I do it</h1>

<ul>
<li>move logic out of data objects</li>
<li>decorators</li>
<li>composition</li>
<li>DCI: Data + Context + Interaction</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="decoupling/decoupling/1">
<h1>decorators</h1>

<ul>
<li>e.g., objects for views</li>
<li>better than per-class helpers</li>
<li><a href="https://github.com/jcasimir/draper">Draper</a></li>
<li>SimpleDelegator</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/2">
<pre class="sh_ruby"><code>

class Address
  # extend with your favourite persistence solution





end









&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/3">
<pre class="sh_ruby"><code>

class Address
  # extend with your favourite persistence solution or:
  attr_accessor :street, :postcode, :city, :country

  def initialize args = {}
    args.each { |key, value| send "#{key}=", value }
  end
end









&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/4">
<pre class="sh_ruby"><code>

class Address
  # extend with your favourite persistence solution or:
  attr_accessor :street, :postcode, :city, :country

  def initialize args = {}
    args.each { |key, value| send "#{key}=", value }
  end
end






# Fryderyka Joliot-Curie 15
# 50-001 Wroc&#x142;aw
# Poland
&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/5">
<pre class="sh_ruby"><code>

class Address
  # extend with your favourite persistence solution or:
  attr_accessor :street, :postcode, :city, :country

  def initialize args = {}
    args.each { |key, value| send "#{key}=", value }
  end
end

class PolishAddress




  def formatted
    [street, "#{postcode} #{city}", country].join "\n"
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/6">
<pre class="sh_ruby"><code>require 'delegate'

class Address
  # extend with your favourite persistence solution or:
  attr_accessor :street, :postcode, :city, :country

  def initialize args = {}
    args.each { |key, value| send "#{key}=", value }
  end
end

class PolishAddress &lt; SimpleDelegator
  def initialize address
    super address
  end

  def formatted
    [street, "#{postcode} #{city}", country].join "\n"
  end
end</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/7">
<pre class="sh_ruby"><code>address = Address.new street: 'Fryderyka Joliot-Curie 15',
    postcode: '50-001', city: 'Wroc&#x142;aw', country: 'Poland'









&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/8">
<pre class="sh_ruby"><code>address = Address.new street: 'Fryderyka Joliot-Curie 15',
    postcode: '50-001', city: 'Wroc&#x142;aw', country: 'Poland'

polish_address = PolishAddress.new address







&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/9">
<pre class="sh_ruby"><code>address = Address.new street: 'Fryderyka Joliot-Curie 15',
    postcode: '50-001', city: 'Wroc&#x142;aw', country: 'Poland'

polish_address = PolishAddress.new address

polish_address.country   # =&gt; Poland





&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/10">
<pre class="sh_ruby"><code>address = Address.new street: 'Fryderyka Joliot-Curie 15',
    postcode: '50-001', city: 'Wroc&#x142;aw', country: 'Poland'

polish_address = PolishAddress.new address

polish_address.country   # =&gt; Poland

puts polish_address.formatted

# Fryderyka Joliot-Curie 15
# 50-001 Wroc&#x142;aw
# Poland</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="decoupling/decoupling/11">
<h1>decorators</h1>

<ul>
<li>let your data objects be data objects</li>
<li>logic in bussiness? behaviour? objects</li>
<li>bonus: ease of testing + reuse</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="decoupling/decoupling/12">
<h1>composition over inheritance</h1>

<ul>
<li><div class="quote">Inheritance is a code smell. There, I said it. &#xA0; &#x2014; Chris Strom</div></li>
<li>compose domain objects from data objects</li>
<li>Forwardable</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/13">
<pre class="sh_ruby"><code>class Address
  # extend with your favourite persistence solution or:
  attr_accessor :street, :postcode, :city, :country

  def initialize args = {}
    args.each { |key, value| send "#{key}=", value }
  end
end








&#xA0;</code></pre>

<p>&#xA0;</p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/14">
<pre class="sh_ruby"><code>class Address
  # extend with your favourite persistence solution or:
  attr_accessor :street, :postcode, :city, :country

  def initialize args = {}
    args.each { |key, value| send "#{key}=", value }
  end
end

class Person
  # extend with your favourite persistence solution or:
  attr_accessor :given_names, :surname

  def initialize args = {}
    args.each { |key, value| send "#{key}=", value }
  end
end</code></pre>

<p>&#xA0;</p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/15">
<pre class="sh_ruby"><code>class Address
  # extend with your favourite persistence solution or:
  attr_accessor :street, :postcode, :city, :country

  def initialize args = {}
    args.each { |key, value| send "#{key}=", value }
  end
end

class Person
  # extend with your favourite persistence solution or:
  attr_accessor :given_names, :surname   # *

  def initialize args = {}
    args.each { |key, value| send "#{key}=", value }
  end
end</code></pre>

<p>* please read <a href="http://www.w3.org/International/questions/qa-personal-names">Personal names around the world</a></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/16">
<pre class="sh_ruby"><code>

class PolishEnvelopeAddress


  def initialize args
    @person  = args.fetch :person,  Person.new
    @address = args.fetch :address, Address.new
  end




  # Sz.P. A. None Mouse
  # Fryderyka Joliot-Curie 15
  # 50-001 Wroc&#x142;aw
  # Poland
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/17">
<pre class="sh_ruby"><code>

class PolishEnvelopeAddress


  def initialize args
    @person  = args.fetch :person,  Person.new
    @address = args.fetch :address, Address.new
  end




  def formatted
    ["Sz.P. #{given_names} #{surname}",
      street, "#{postcode} #{city}", country].join "\n"
  end
end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/18">
<pre class="sh_ruby"><code>require 'forwardable'

class PolishEnvelopeAddress
  extend Forwardable

  def initialize args
    @person  = args.fetch :person,  Person.new
    @address = args.fetch :address, Address.new
  end

  def_delegators :@person,  :given_names, :surname
  def_delegators :@address, :street, :postcode, :city, :country

  def formatted
    ["Sz.P. #{given_names} #{surname}",
      street, "#{postcode} #{city}", country].join "\n"
  end
end</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/19">
<pre class="sh_ruby"><code>person = Person.new given_names: 'A. None', surname: 'Mouse'














&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/20">
<pre class="sh_ruby"><code>person = Person.new given_names: 'A. None', surname: 'Mouse'

address = Address.new street: 'Fryderyka Joliot-Curie 15',
    postcode: '50-001', city: 'Wroc&#x142;aw', country: 'Poland'











&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/21">
<pre class="sh_ruby"><code>person = Person.new given_names: 'A. None', surname: 'Mouse'

address = Address.new street: 'Fryderyka Joliot-Curie 15',
    postcode: '50-001', city: 'Wroc&#x142;aw', country: 'Poland'

pea = PolishEnvelopeAddress.new person: person, address: address









&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/22">
<pre class="sh_ruby"><code>person = Person.new given_names: 'A. None', surname: 'Mouse'

address = Address.new street: 'Fryderyka Joliot-Curie 15',
    postcode: '50-001', city: 'Wroc&#x142;aw', country: 'Poland'

pea = PolishEnvelopeAddress.new person: person, address: address

pea.surname   # =&gt; 'Mouse'
pea.city      # =&gt; 'Wroc&#x142;aw'






&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/23">
<pre class="sh_ruby"><code>person = Person.new given_names: 'A. None', surname: 'Mouse'

address = Address.new street: 'Fryderyka Joliot-Curie 15',
    postcode: '50-001', city: 'Wroc&#x142;aw', country: 'Poland'

pea = PolishEnvelopeAddress.new person: person, address: address

pea.surname   # =&gt; 'Mouse'
pea.city      # =&gt; 'Wroc&#x142;aw'

puts pea.formatted

# Sz.P. A. None Mouse
# Fryderyka Joliot-Curie 15
# 50-001 Wroc&#x142;aw
# Poland</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="decoupling/decoupling/24">
<h1>composition over inheritance</h1>

<ul>
<li>domain models composed from data models</li>
<li>persistence as a component?</li>
<li>&#x2026;so you can dependency-inject it</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="decoupling/decoupling/25">
<h1>DCI</h1>

<ul>
<li>Data + Context + Interaction</li>
<li>data objects (1:1 persistence?)</li>
<li>per-role behaviour: mixins extending data</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/26">
<pre class="sh_ruby"><code>module Data
  class Person
    # &#x2026;
  end

  class Address
    # &#x2026;
  end
end</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/27">
<pre class="sh_ruby"><code>module Roles
  module Landlord
    def rent_a_place address, person
      # rent only if the person is credible (as a tenant)
    end
  end

  module Tenant
    def credible?
      # &#x2026;
    end
  end
end</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/28">
<pre class="sh_ruby"><code>module Contexts
  class RentingAPlace
    def initialize address, person_a, person_b
      @address  = address
      @landlord = person_a.extend Roles::Landlord
      @tenant   = person_b.extend Roles::Tenant
    end
  end

  def call
    # &#x2026;
    @landlord.rent_a_place @address, @tenant
    # &#x2026;
  end
end</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/29">
<pre class="sh_ruby"><code>address  = &#x2026;   # probably fetch from persistence store
person_a = &#x2026;   # probably fetch from persistence store
person_b = &#x2026;   # probably fetch from persistence store

renting = Contexts::RentingAPlace.new address, person_a, person_b

renting.call</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="decoupling/decoupling/30">
<h1>DCI</h1>

<ul>
<li>it&#x2019;s not about persistence</li>
<li>it&#x2019;s a fundamental architectural change</li>
<li>data | behaviour separation</li>
<li>read <em><a href="http://mikepackdev.com/blog_posts/24-the-right-way-to-code-dci-in-ruby">The Right Way to Code DCI in Ruby</a></em></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollRight"><div class="content center" ref="decoupling/decoupling/31">
<p><img src="./file/decoupling/cops.jpg" alt="cops"/>
<a href="http://tdpri.com/forum/2602851-post1573.html"><em>THE</em> Random Picture Thread</a></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="decoupling/decoupling/32">
<h1>going way overboard (?)</h1>

<ul>
<li>it&#x2019;s all about objects</li>
<li>why not hide persistance altogether?</li>
<li><a href="https://github.com/SFEley/candy">Candy</a></li>
<li><a href="http://defunkt.io/ambition">Ambition</a></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/33">
<h2>Candy: transparent persistence in MongoDB</h2>

<pre class="sh_ruby"><code>require 'candy'













&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/34">
<h2>Candy: transparent persistence in MongoDB</h2>

<pre class="sh_ruby"><code>require 'candy'

class Conference
  include Candy::Piece
end









&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/35">
<h2>Candy: transparent persistence in MongoDB</h2>

<pre class="sh_ruby"><code>require 'candy'

class Conference
  include Candy::Piece
end

wrocloverb = Conference.new
# connects to localhost:27017 and &#x2018;chastell&#x2019; db if needed
# and saves a new document to the &#x2018;Conference&#x2019; collection





&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/36">
<h2>Candy: transparent persistence in MongoDB</h2>

<pre class="sh_ruby"><code>require 'candy'

class Conference
  include Candy::Piece
end

wrocloverb = Conference.new
# connects to localhost:27017 and &#x2018;chastell&#x2019; db if needed
# and saves a new document to the &#x2018;Conference&#x2019; collection

wrocloverb.location = 'Wroc&#x142;aw'   # method_missing resaves



&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/37">
<h2>Candy: transparent persistence in MongoDB</h2>

<pre class="sh_ruby"><code>require 'candy'

class Conference
  include Candy::Piece
end

wrocloverb = Conference.new
# connects to localhost:27017 and &#x2018;chastell&#x2019; db if needed
# and saves a new document to the &#x2018;Conference&#x2019; collection

wrocloverb.location = 'Wroc&#x142;aw'   # method_missing resaves

wrocloverb.events = { parties: { saturday: 'Cynamon Bar' } }
wrocloverb.events.parties.saturday    #=&gt; 'Cynamon Bar'
&#xA0;</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="decoupling/decoupling/38">
<h2>Ambition: persistence queries in Ruby</h2>

<pre class="sh_ruby"><code>require 'ambition/adapters/active_record'













&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/39">
<h2>Ambition: persistence queries in Ruby</h2>

<pre class="sh_ruby"><code>require 'ambition/adapters/active_record'

class Person &lt; ActiveRecord::Base
end










&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/40">
<h2>Ambition: persistence queries in Ruby</h2>

<pre class="sh_ruby"><code>require 'ambition/adapters/active_record'

class Person &lt; ActiveRecord::Base
end

Person.select do |p|
  (p.country == 'USA' &amp;&amp; p.age &gt;= 21) ||
  (p.country != 'USA' &amp;&amp; p.age &gt;= 18)
end





&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/41">
<h2>Ambition: persistence queries in Ruby</h2>

<pre class="sh_ruby"><code>require 'ambition/adapters/active_record'

class Person &lt; ActiveRecord::Base
end

Person.select do |p|
  (p.country == 'USA' &amp;&amp; p.age &gt;= 21) ||
  (p.country != 'USA' &amp;&amp; p.age &gt;= 18)
end

# SELECT * FROM people
# WHERE (
#   (people.country =  'USA' AND people.age &gt;= 21) OR
#   (people.country &lt;&gt; 'USA' AND people.age &gt;= 18)
# )</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="decoupling/decoupling/42">
<h2>Ambition: persistence queries in Ruby</h2>

<pre class="sh_ruby"><code>require 'ambition/adapters/active_ldap'

class Person &lt; ActiveLdap::Base
end

Person.select do |p|
  (p.country == 'USA' &amp;&amp; p.age &gt;= 21) ||
  (p.country != 'USA' &amp;&amp; p.age &gt;= 18)
end

# (|
#   (&amp; (country=USA)    (age&gt;=21) )
#   (&amp; (!(country=USA)) (age&gt;=18) )
# )
&#xA0;</code></pre></div>
</div><div class="slide" data-transition="scrollRight"><div class="content center" ref="decoupling/decoupling/43">
<p><img src="./file/decoupling/giraffe.jpg" alt="giraffe"/>
<a href="http://www.johnnycheeseburger.com/post/1528439687">giraffes of iwo jima</a></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="summary/summary/1">
<h1>world domination plans</h1>

<ul>
<li>don&#x2019;t <code>rails g model</code>-drive you design</li>
<li>various ways to persist objects (PStore!)</li>
<li>learn about your persistence layer&#x2019;s features</li>
<li>disassociate models from persistence</li>
<li>play with decorators, composition, DCI</li>
<li>read <em><a href="http://www.w3.org/International/questions/qa-personal-names">Personal names around the world</a></em></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content center" ref="summary/summary/2">
<p><img src="./file/summary/passports.jpg" alt="I fucking LOVE passports"/>
<a href="http://sfwchan.com/?id=4823">swfChan</a></p></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets" ref="summary/summary/3">
<h1>questions?</h1>

<ul>
<li><a href="mailto:chastell@chastell.net">chastell@chastell.net</a></li>
<li><a href="http://chastell.net">@chastell | chastell.net</a></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="summary/summary/4">
<h1>further reading</h1>

<ul>
<li><span style="font-family: Ubuntu, sans-serif"><a href="http://decoupling-wrocloverb-2012.heroku.com">decoupling-wrocloverb-2012.heroku.com</a></span></li>
<li><a href="http://objectsonrails.com">Objects on Rails</a></li>
<li><a href="http://confreaks.com/videos/759-rubymidwest2011-keynote-architecture-the-lost-years">Architecture: The Lost Years</a></li>
<li><a href="http://solnic.eu/2011/08/01/making-activerecord-models-thin.html">Making ActiveRecord Models Thin</a></li>
<li><a href="http://architects.dzone.com/articles/polyglot-persistence-future">The Future Is Polyglot Persistence</a></li>
<li><a href="http://rubyrogues.com/object-oriented-programming-in-rails-with-jim-weirich">Object Oriented Programming in Rails</a></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content center" ref="summary/summary/5">
<p><img src="./file/summary/sochack.png" alt="SocHack"/></p>

<h2><a href="http://sochack.pl/edukacja2012">hackathon for worthy causes</a></h2>

<h2>next weekend in Warsaw</h2></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content center" ref="summary/summary/6">
<p><img src="./file/summary/party-hard.jpg" alt="PARTY HARD"/>
<a href="http://9gag.com/gag/139996">9GAG: Party Hard</a></p></div>
</div></div>

</body>
</html>
