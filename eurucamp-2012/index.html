<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Ruby on the Command-Line</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  
    <link rel="stylesheet" href="file/eurucamp-2012.css" type="text/css"/>
  

  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content" ref="cover/cover">
<h1>Ruby</h1>

<h1>on the</h1>

<h1>Command-Line</h1></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets center incremental" ref="me-me-me/me-me-me/1">
<p><img src="./file/me-me-me/chastell.png" alt="chastell"/></p>

<h1>me, me, me.</h1>

<ul>
<li>(that&#x2019;s Piotr Szotkowski)</li>
<li>(or <a href="http://chastell.net">chastell</a>)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="me-me-me/me-me-me/2">
<p><img src="./file/me-me-me/wut.png" alt="Warsaw University of Technology"/>
&#xA0;</p>

<h2>assistant professor</h2>

<h2>at <a href="http://eng.pw.edu.pl">Warsaw University of Technology</a></h2></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="me-me-me/me-me-me/3">
<p><img src="./file/me-me-me/rebased.png" alt="Rebased"/>
&#xA0;</p>

<h2>cheap science officer</h2>

<h2>at <a href="http://rebased.pl">Rebased</a></h2></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content commandline incremental" ref="executable/executable/1">
<h1>one does not simply&#x2026;</h1>

<pre><code><code class="command">$ fantastic --help</code>
<code class="result">Usage: fantastic [options] conference
Options:
  --location, -l &lt;s&gt;:   Conference location
          --help, -h:   Show this message

</code><code class="command">$ fantastic --location M&#xFC;ggelsee eurucamp</code>
<code class="result">eurucamp at M&#xFC;ggelsee is fantastic! \o/
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="executable/executable/2">
<h1>actually, one does.</h1></div>
</div><div class="slide" data-transition="none"><div class="content" ref="executable/executable/3">
<h1><code>bin/fantastic</code></h1>

<pre class="sh_ruby"><code>#!/usr/bin/env ruby














&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="executable/executable/4">
<h1><code>bin/fantastic</code></h1>

<pre class="sh_ruby"><code>#!/usr/bin/env ruby
require_relative '../lib/fantastic/executable'













&#xA0;</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="executable/executable/5">
<h1><code>bin/fantastic</code></h1>

<pre class="sh_ruby"><code>#!/usr/bin/env ruby
require_relative '../lib/fantastic/executable'
Fantastic::Executable.new(ARGV).run












&#xA0;</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="executable/executable/6">
<h1><code>lib/fantastic/executable.rb</code></h1>

<pre class="sh_ruby"><code>

module Fantastic class Executable









  def run
    puts "#{@conf} at #{@opts[:location]} is fantastic! \\o/"
  end
end end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="executable/executable/7">
<h1><code>lib/fantastic/executable.rb</code></h1>

<pre class="sh_ruby"><code>

module Fantastic class Executable
  def initialize args






  end

  def run
    puts "#{@conf} at #{@opts[:location]} is fantastic! \\o/"
  end
end end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="executable/executable/8">
<h1><code>lib/fantastic/executable.rb</code></h1>

<pre class="sh_ruby"><code>require 'trollop'

module Fantastic class Executable
  def initialize args
    @opts = Trollop.options args do


      opt :location, 'Conference location', type: String
    end

  end

  def run
    puts "#{@conf} at #{@opts[:location]} is fantastic! \\o/"
  end
end end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="executable/executable/9">
<h1><code>lib/fantastic/executable.rb</code></h1>

<pre class="sh_ruby"><code>require 'trollop'

module Fantastic class Executable
  def initialize args
    @opts = Trollop.options args do
      banner 'Usage: fantastic [options] conference'
      banner 'Options:'
      opt :location, 'Conference location', type: String
    end

  end

  def run
    puts "#{@conf} at #{@opts[:location]} is fantastic! \\o/"
  end
end end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="executable/executable/10">
<h1><code>lib/fantastic/executable.rb</code></h1>

<pre class="sh_ruby"><code>require 'trollop'

module Fantastic class Executable
  def initialize args
    @opts = Trollop.options args do
      banner 'Usage: fantastic [options] conference'
      banner 'Options:'
      opt :location, 'Conference location', type: String
    end
    @conf = args.first
  end

  def run
    puts "#{@conf} at #{@opts[:location]} is fantastic! \\o/"
  end
end end</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="testing/testing/1">
<h1><code>spec/fantastic/executable_spec.rb</code></h1>

<pre class="sh_ruby"><code>

require 'minitest/autorun'
require_relative '../../lib/fantastic/executable'

module Fantastic describe Executable do









end end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="testing/testing/2">
<h1><code>spec/fantastic/executable_spec.rb</code></h1>

<pre class="sh_ruby"><code>

require 'minitest/autorun'
require_relative '../../lib/fantastic/executable'

module Fantastic describe Executable do
  describe '#run' do
    it 'works as expected' do





    end
  end
end end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="testing/testing/3">
<h1><code>spec/fantastic/executable_spec.rb</code></h1>

<pre class="sh_ruby"><code># encoding: UTF-8

require 'minitest/autorun'
require_relative '../../lib/fantastic/executable'

module Fantastic describe Executable do
  describe '#run' do
    it 'works as expected' do

        Executable.new(['--location', 'M&#xFC;ggelsee', 'eurucamp']).run

      out.must_include 'eurucamp at M&#xFC;ggelsee is fantastic! \o/'

    end
  end
end end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="testing/testing/4">
<h1><code>spec/fantastic/executable_spec.rb</code></h1>

<pre class="sh_ruby"><code># encoding: UTF-8

require 'minitest/autorun'
require_relative '../../lib/fantastic/executable'

module Fantastic describe Executable do
  describe '#run' do
    it 'works as expected' do
      out      = capture_io do
        Executable.new(['--location', 'M&#xFC;ggelsee', 'eurucamp']).run
      end
      out.must_include 'eurucamp at M&#xFC;ggelsee is fantastic! \o/'

    end
  end
end end</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="testing/testing/5">
<h1><code>spec/fantastic/executable_spec.rb</code></h1>

<pre class="sh_ruby"><code># encoding: UTF-8

require 'minitest/autorun'
require_relative '../../lib/fantastic/executable'

module Fantastic describe Executable do
  describe '#run' do
    it 'works as expected' do
      out, err = capture_io do
        Executable.new(['--location', 'M&#xFC;ggelsee', 'eurucamp']).run
      end
      out.must_include 'eurucamp at M&#xFC;ggelsee is fantastic! \o/'
      err.must_be :empty?
    end
  end
end end</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="cli/cli">
<h1>command-line interface</h1>

<ul>
<li>provide long options: <code>--long</code></li>
<li>provide short options: <code>-s</code></li>
<li>provide <code>--no-*</code> switches</li>
<li>consider command suites</li>
<li>man page: <code>gem-man</code> + <code>ronn</code></li>
<li>add tab completion</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content commandline incremental" ref="ruby/ruby/1">
<h1><code>ARGV</code> &amp; <code>ARGF</code></h1>

<pre><code><code class="command">$ cat confs.2012.1</code>
<code class="result">wroc_love.rb
SRC

</code><code class="command">$ cat confs.2012.2</code>
<code class="result">eurucamp
Arrrrcamp
RuPy

</code><code class="command">$ ruby -e 'p ARGV' confs.2012.*</code>
<code class="result">["confs.2012.1", "confs.2012.2"]

</code><code class="command">$ ruby -e 'p ARGF.to_a' confs.2012.*</code>
<code class="result">["wroc_love.rb\n", "SRC\n", "eurucamp\n", "Arrrrcamp\n", "RuPy\n"]

</code><code class="command">$ ruby -e 'p ARGF.path; ARGF.skip; p ARGF.to_a' confs.2012.*</code>
<code class="result">"confs.2012.1"
["eurucamp\n", "Arrrrcamp\n", "RuPy\n"]
</code></code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="ruby/ruby/2">
<h1>streams</h1>

<ul>
<li>output &#x2192; <code>$stdout</code></li>
<li>errors &#x2192; <code>$stderr</code></li>
<li>input &#x2190; <code>$stdin</code></li>
<li><code>$stdout</code> &#xA0; <code>$stderr</code> &#xA0; <code>$stdin</code></li>
<li>&#x2191; variables &#x2191; &#xA0; vs &#xA0; &#x2193; constants &#x2193;</li>
<li><code>STDOUT</code> &#xA0; <code>STDERR</code> &#xA0; <code>STDIN</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="ruby/ruby/3">
<h1><code>FileUtils</code> &amp; <code>tempfile</code></h1>

<ul>
<li><code>FileUtils.mkdir_p '/tmp/foo/bar/baz'&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
<li><code>FileUtils.rm_rf '/tmp/foo'&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
<li><code>let(:file) { Tempfile.new 'foo' }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code># #&lt;File:/tmp/foo20120818-21526-12fjarq&gt;</code><br/>
<code># no need to remove afterwards&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
<li><code>let(:path) { Dir.mktmpdir }&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code># "/tmp/d20120818-21526-11xj17r"&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code>after &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{ FileUtils.rmtree path }&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="ruby/ruby/4">
<h2>XDG Base Directory Standard</h2>

<ul>
<li><code>~/.config/fantastic</code></li>
<li><code>~/.cache/fantastic</code></li>
<li><code>~/.local/shared/fantastic</code></li>
<li><code>gem install xdg</code></li>
<li><code>XDG['CONFIG'] &#xA0;# '/home/chastell/.config'&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code>XDG['CACHE'] &#xA0;&#xA0;# '/home/chastell/.cache'&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code>XDG['DATA'] &#xA0; &#xA0;# '/home/chastell/.local/share'</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="ruby/ruby/5">
<h1>system calls</h1>

<ul>
<li><code>path = '/etc/passwd'&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code>out &#xA0;= system "cat #{path}" &#xA0; # UNSAFE</code></li>
<li><code>path = '/etc/passwd; rm -rf /etc'&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code>out &#xA0;= system "cat #{path}" &#xA0; # UNSAFE</code></li>
<li><code>path = '/etc/passwd; rm -rf /etc'&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code>out &#xA0;= system 'cat', path&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
<li><code>path = '/etc/passwd; rm -rf /etc'&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code>out &#xA0;= system *%W[cat #{path}]&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="posix/posix/1">
<h1>be nice to processes</h1>

<ul>
<li><code>$PROGRAM_NAME = 'fantastic'&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
<li><code>$PROGRAM_NAME = "dump (#{progress}% complete)"</code><br/>
<code>$PROGRAM_NAME = "dump (#{time}s left)"&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
<li><code>exit&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code>exit 1&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
<li><code>Errs = { foo: 1, bar: 2, baz: 4, qux: 64 }&#xA0;&#xA0;&#xA0;&#xA0;</code><br/>
<code>exit Errs[:foo] | Errs[:baz] | Errs[:qux]&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
<li><code>abort 'bad user!'&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="posix/posix/2">
<h1>it&#x2019;s a trap!</h1>

<ul>
<li><code>Signal.list</code></li>
<li><code>trap :EXIT { puts 'so exiting!' }</code></li>
<li><code>:TERM</code> vs <code>:KILL</code></li>
<li><code>:INT&#xA0;&#xA0;&#xA0;&#xA0;# ctrl-c</code><br/>
<code>:HUP&#xA0;&#xA0;&#xA0;&#xA0;# config</code><br/>
<code>:USR1&#xA0;&#xA0;&#xA0;# debug?</code></li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="posix/posix/3">
<h1>Resque</h1>

<table>
  <tr><th>QUIT</th><td>wait for child to finish then exit</td></tr>
  <tr><th>TERM, INT</th><td>immediately kill child then exit</td></tr>
  <tr><th>USR1</th><td>immediately kill child but don&#x2019;t exit</td></tr>
  <tr><th>USR2</th><td>don&#x2019;t start to process any new jobs</td></tr>
  <tr><th>CONT</th><td>process new jobs again after a USR2</td></tr>
</table>


</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content" ref="posix/posix/4">
<h1>Unicorn</h1>

<table>
  <tr><th>HUP</th><td>reloads config and restart workers</td></tr>
  <tr><th>INT, TERM</th><td>quick shutdown, kills all workers</td></tr>
  <tr><th>QUIT</th><td>graceful shutdown master</td></tr>
  <tr><th>USR1</th><td>reopen all logs</td></tr>
  <tr><th>USR2</th><td>reexecute the running binary</td></tr>
  <tr><th>WINCH</th><td>gracefully stops workers</td></tr>
  <tr><th>TTIN</th><td>increment number of workers by one</td></tr>
  <tr><th>TTOU</th><td>decrement number of workers by one</td></tr>
</table>


</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content commandline incremental" ref="posix/posix/5">
<h1><code>trap :PIPE, :EXIT</code></h1>

<pre><code><code class="command">$ ruby -e '$stdout.sync = true; loop { puts "."; sleep 1 }' | head -3</code>
<code class="result">.
.
.
-e:1:in `write': Broken pipe - &lt;STDOUT&gt; (Errno::EPIPE)
  from -e:1:in `puts'
  from -e:1:in `puts'
  from -e:1:in `block in &lt;main&gt;'
  from -e:1:in `loop'
  from -e:1:in `&lt;main&gt;'

</code><code class="command">$ ruby -e '&#x2026;; trap(:PIPE, :EXIT); loop { puts "."; sleep 1 }' | head -3</code>
<code class="result">.
.
.

</code><code class="command">$ # next command</code>
</code></pre></div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental" ref="console/console">
<h1>console</h1>

<ul>
<li><code>rows, cols = `stty size`.split.map &amp;:to_i</code></li>
<li>progress: <code>progressbar</code> &amp; <code>progress</code></li>
<li>tables: <code>terminal-tables</code> &amp; <code>hirb</code></li>
<li>colour: <code>rainbow</code> &amp; <code>painter</code></li>
<li><code>$stdout.tty?</code></li>
<li>output formats</li>
</ul>
</div>
</div><div class="slide" data-transition="scrollLeft"><div class="content bullets incremental small" ref="links/links">
<h1>thanks! and please digest:</h1>

<ul>
<li><a href="http://www.awesomecommandlineapps.com">Build Awesome Command-Line<br/>Applications in Ruby</a></li>
<li><a href="http://workingwithunixprocesses.com">Working With Unix Processes</a></li>
<li><a href="http://t-a-w.blogspot.com/2012/07/collection-of-small-unix-utilities.html">Collection of small Unix<br/>utilities written in Ruby</a></li>
<li><a href="http://programme.scottishrubyconference.com/proposals/102/video">Writing Beautiful Command Line Programs</a></li>
<li><a href="http://programme.scottishrubyconference.com/proposals/34/video">Test-drive the development of your<br/>command-line applications</a></li>
<li><a href="http://chastell.net">@chastell</a> | <a href="http://talks.chastell.net">talks.chastell.net</a></li>
</ul>
</div>
</div></div>

</body>
</html>
